using Feather_Server.Database;
using Feather_Server.MobRelated;
using Feather_Server.PlayerRelated;
using Feather_Server.PlayerRelated.Model;
using Feather_Server.PlayerRelated.Skills;
using Feather_Server.ServerRelated;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Data.SQLite;
using System.Drawing;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;

namespace Feather_Server.ServerRelated
{
    public class Server
    {
        TcpListener srv = null;

        public Server(string ip, int port)
        {
            IPAddress addr = IPAddress.Parse(ip);
            srv = new TcpListener(addr, port);
            srv.Server.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, 1);
            srv.Start();
            this.listen();
        }

        public void listen()
        {
            while (true)
            {
                TcpClient client = srv.AcceptTcpClient();
                Thread t = new Thread(new ParameterizedThreadStart(handleClient));
                t.Start(client);
            }
        }

        public void handleClient(object obj)
        {
            TcpClient cli = (TcpClient)obj;

            var info = ((IPEndPoint)cli.Client.RemoteEndPoint);
            Console.WriteLine($"[+] Client[{info.Address}:{info.Port}] Connected!");

            var stream = cli.GetStream();

            // send handshake pkt
            var hs = new byte[] { 0x03, 0x01, 0x02, 0x03, 0x02, 0x01, 0x00 };
            stream.Write(hs, 0, hs.Length);

            // read RSA pubKey
            var tmp_pubKey = new byte[90];
            stream.Read(tmp_pubKey);

            // send AES [pkt[0]]
            // TODO: random gen 32 bytes aes key
            var aesKey = new byte[] {
                0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41
            };
            var pubKey = new byte[74];
            // take only the last 74 bytes
            Buffer.BlockCopy(tmp_pubKey, 16, pubKey, 0, 74);

            var ori_aesKey = Lib.rsaEncrypt(pubKey, aesKey);
            var aesKeyPkt = new byte[ori_aesKey.Length + 1];
            ori_aesKey.CopyTo(aesKeyPkt, 0);
            aesKeyPkt[aesKeyPkt.Length - 1] = 0x00;
            stream.Write(aesKeyPkt);

            // send LOGIN check request [pkt[1]]
            var aes = new AES(aesKey);
            var pkt = new byte[] {
                // another AES secret for the password encryption
                  0x29, 0x49, 0x01, 0x01, // packet header
                        // AES secret here (me better ignore this shit xDD, the password store in plain text in database? i cant do this with my hand lol)
                        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                  0x01, 0x5d
            };
            byte[] logReq = aes.encrypt(pkt);
            stream.Write(logReq);

            // LOGIN 1.3.0.10 11 kalvin00001 26CC6E5F10B90169818A8D7CF883829E   // pw ck
            // LOGIN 1.3.0.10 11 kalvin00001 26CC6E5F10B90169818A8D7CF883829E 1 // join with hero: 1
            // DELETE_USER 1.3.0.10 11 kalvin00001 26CC6E5F10B90169818A8D7CF883829E 29969 1 // request delete user id = 29969 (0x7511)
            // DELETE_USER 1.3.0.10 11 kalvin00001 26CC6E5F10B90169818A8D7CF883829E 29969 3 //  cancel delete user id = 29969 (0x7511)
            var client = new Client(aes, cli);
            loginCheck(client);
        }

        public void loginCheck(Client client)
        {
            // Login pkt
            var loginInfo = Encoding.ASCII.GetString(
                client.read(80)
            );

            if (loginInfo.StartsWith("version 0"))
            {
                // create hero
                client.send(Lib.hexToBytes(
                    "03fffe00"
                ));
                loginInfo = Encoding.ASCII.GetString(
                    client.read(180)
                );
            }
            if (loginInfo.StartsWith("LOGIN 1.3.0.10 11 "))
            {
                var info = loginInfo.Substring(18).Split('\r')[0].Split(" ");
                var pw = info[1].Substring(0, 32);

                List<int> heroIDs;
                var isSuccess = DB2.GetInstance().LoginUser(info[0], pw, out heroIDs);
                // filter out NULL (-1) heroID
                heroIDs.RemoveAll(v => v == -1);

                if (!isSuccess)
                {
                    Console.WriteLine($"[!] Incorrect Password. [{loginInfo.Split('\r')[0]}]");
                    // login fail
                    client.send(PacketEncoder.alertBox(7002230));
                    client.Dispose();
                    return;
                }

                var isInHeroCreation = false;
                if (info.Length == 3)
                {
                    // join server
                    srvJoinCheck(client, info);
                    return;
                }
                else if (info.Length < 2)
                {
                    Console.WriteLine($"[!] Unknown Pkt. [{loginInfo}]");
                    client.Dispose();
                    return;
                }
                else if (info.Length == 9)
                {
                    // create hero
                    // LOGIN 1.3.0.10 11 kalvin00002 26CC6E5F10B90169818A8D7CF883829E AAABf [sex]2 [icon]1002 [hairCut]1002 [hairColor]27183 [pos]6 [role]4

                    isInHeroCreation = true;
                    Console.WriteLine($"[+] Create Hero. [{loginInfo.Split('\r')[0]}]");
                    var name = info[2];

                    // TODO: same name check
                    // error: 07_21_02_2b_0f_00_00_00_

                    var gender = byte.Parse(info[3]);
                    var icon = ushort.Parse(info[4]);
                    var hairCut = ushort.Parse(info[5]);
                    var hairColor = ushort.Parse(info[6]);
                    var pos = byte.Parse(info[7]);
                    var role = byte.Parse(info[8]);
                    Role roleID;

                    //武士 # 01
                    //劍客 # 02
                    //術士 # 03
                    //天師 # 04
                    //祭師 # 05

                    switch (role)
                    {
                        case 2:
                            roleID = Role.JK;
                            break;
                        case 3:
                            roleID = Role.SS;
                            break;
                        case 4:
                            roleID = Role.TS;
                            break;
                        case 5:
                            roleID = Role.JS;
                            break;
                        default:
                            roleID = Role.WS;
                            break;
                    }

                    var basicInfo = new HeroBasicInfo(
                        Lib.lastUID,
                        name,
                        gender == 1 ? Gender.BOY : Gender.GIRL,
                        roleID,
                        new Hair(
                            icon,
                            hairCut,
                            hairColor
                        ),
                        0,
                        new HeroModel(
                            new PlayerRelated.Items.EquippableItem(0x0000, 0x0000),
                            new PlayerRelated.Items.EquippableItem(0x0000, 0x0000),
                            new PlayerRelated.Items.EquippableItem(0x0000, 0x0000),
                            new PlayerRelated.Items.EquippableItem(0x0000, 0x0000),
                            new PlayerRelated.Items.EquippableItem(0x0000, 0x0000),
                                new PlayerRelated.Items.WeaponItem(0x0000, Color.FromArgb(0x00, 0x00, 0x00, 0x00))
                        )
                    );
                    var fullInfo = new Hero(basicInfo);

                    // assign role default values
                    int[] defs = Lib.roleDefault[roleID];

                    fullInfo.hp = defs[0];
                    fullInfo.maxHP = defs[0];
                    fullInfo.mp = defs[1];
                    fullInfo.maxMP = defs[1];
                    fullInfo.meleeDamage = defs[2];
                    fullInfo.meleeDefense = defs[3];
                    fullInfo.magicDamage = defs[4];
                    fullInfo.magicDefense = defs[5];
                    fullInfo.hit = defs[6];
                    fullInfo.dodge = defs[7];
                    fullInfo.criticalHitRate = defs[8];

                    fullInfo.rideList = new List<Ride>();
                    fullInfo.petList = new List<Pet>();
                    fullInfo.equips = new EquipmentSet();
                    fullInfo.bag = new Bag();
                    // fullInfo.lifeMake = new __(); // TODO: lifeMake class init

                    if (!DB2.GetInstance().Insert(
                        "Hero",
                        new Dictionary<string, object>()
                        {
                            {
                                "heroID", Lib.lastUID
                            },
                            {
                                "playerName", name
                            },
                            {
                                "basicInfo", basicInfo.toJson()
                            },
                            {
                                "fullInfo", fullInfo.playerToJson()
                            }
                        }
                    ))
                    {
                        // fail to insert (duplicate user name)
                        // TODO: send alertBox msg with ID 2024 “$1”已经有人用了。
                        //PacketEncoder.alertBox();
                        return;
                    }

                    Thread.Sleep(1000);
                    // add to login table
                    DB2.GetInstance().Update(
                        "Login",
                        new Dictionary<string, object>()
                        {
                            { "hero" + pos, Lib.lastUID }
                        },
                        "username = @uname",
                        new Dictionary<string, object>()
                        {
                            { "uname", info[0] }
                        }
                    );

                    heroIDs.Add(Lib.lastUID);
                    Lib.lastUID++;
                }

                Console.WriteLine($"[+] Login. Username[{info[0]}] Pw[{pw}] Heros[{string.Join(", ", heroIDs)}]");

                // login success
                client.send(PacketEncoder.loginSuccess(Lib.getBasicInfos(heroIDs), isInHeroCreation));

                //client.send(new byte[] {
                //    0x07, 0x49, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00,
                //    // body model: 0x15, 0x00 = 小惡裝
                //    // wp: <wp-type (by role)> | <wp-lv>
                //    // wp-type: 3d: 刀 | 3e: 劍 | 3f: 杖
                //    // WP ColorCode: <CC1> <CC2> <CC3> || CC1: self-color CC2: light color CC3: blur (out-light effect)
                ////                    -pos- ----- uid ------  ____  -lv-  --- sex --  ____  ---- ? ---  ____  -- head --  -- hair --                                                  --- hat ---             --- body -- -- split -- --- ? ----  -- split --  -- face -- -- split -- -- tail --  -- split --  - weapon - --WP ColorCode--  ____  --------- ? ----------  _____ ---- name_length -----  ----------- name -----------  ____  -- role --
                //    0x46, 0x49, 0x0d, 0x01, 0x09, 0x37, 0x00, 0x00, 0x29, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3d, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x03, 0x00, 0x00, 0x00, 0xd0, 0xfd, 0x31, 0x64, 0xfe, 0x11, 0x00, 0x00, 0x00, 

                //    0x48, 0x49, 0x0d, 0x01, 0x0c, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xe9, 0x03, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x50, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x61, 0x64, 0xfe, 0x11, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x02, 0x0d, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x51, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x62, 0x64, 0xfe, 0x11, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x03, 0x0e, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x89, 0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x52, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x63, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x04, 0x0f, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x53, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x64, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x05, 0x10, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xea, 0x03, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x15, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x54, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x65, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x06, 0x11, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xea, 0x03, 0x2f, 0x6a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x55, 0x01, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x66, 0x64, 0xff, 0x11, 0x00, 0x00, 0x00,
                ////  4b_49_0d_01_9d_36_00_00_51_11_27_00_00_00_00_02_00_a4_aa_00_00_00_00_00_00_00_00_14_00_00_00_16_00_00_00_00_00_00_00_00_00_00_00_02_00_00_00_3e_08_00_00_df_7b_5e_45_0f_00_73_08_00_00_00_c0_ad_cb_b9_c0_d7_b6_c8_64_ff_11_00_00_00_
                ////  0x4d, 0x49, 0x0d, 0x02, 0x5e, 0x06, 0x00, 0x00, 0x5d, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x07, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x0a, 0x00, 0x00, 0x00, 0xb2, 0xee, 0xb2, 0xbb, 0xb6, 0xe0, 0xcf, 0xc8, 0xc9, 0xfa, 0x64, 0xff, 0x11, 0x00, 0x00, 0x00
                //});
            }
            else if (loginInfo.StartsWith("DELETE_USER 1.3.0.10 11 "))
            {
                var info = loginInfo.Substring(24).Split(" ");
                var action = info[3].Substring(0, 1) == "3";
                Console.WriteLine($"[+] Delete User. Username[{info[0]}] Pw[{info[1].Substring(0, 32)}] ID[{info[2]}] Action[{(action ? "Cancel" : "Delete")}]");

                // delete successful
                // resend hero infos
                //client.send(new byte[]
                //{
                //    0x07, 0x49, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00,
                ////                    -pos- ----- uid ------  ____  -lv-  --- sex --  ____  ---- ? ---  ____  ---------- ? ---------                                                  --- hat ---             --- body -- -- split -- --- ? ----  -- split --  -- face -- -- split -- -- tail --  -- split --  - weapon - ---- ? ---- -- wp Lv --  --------- ? ----------  _____ ---- name_length -----  ----------- name -----------  ____  -- role --
                //    0x48, 0x49, 0x0d, 0x01, 0x0c, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xe9, 0x03, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x3e, 0x07, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x61, 0x64, 0xfe, 0x11, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x02, 0x0d, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x3c, 0x07, 0x00, 0x00, 0x01, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x62, 0x64, 0xfe, 0x11, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x03, 0x0e, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x89, 0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x3f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x63, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x04, 0x0f, 0x75, 0x00, 0x00, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x3d, 0x07, 0x00, 0x00, 0x01, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x64, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x05, 0x10, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xea, 0x03, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x3a, 0x07, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x65, 0x64, 0x01, 0x12, 0x00, 0x00, 0x00,
                //    0x48, 0x49, 0x0d, 0x06, 0x11, 0x75, 0x00, 0x00, 0x00, 0xf9, 0x2a, 0x00, 0x00, 0x00, 0x00, 0xea, 0x03, 0x2f, 0x6a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x39, 0x07, 0x00, 0x00, 0x01, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x05, 0x00, 0x00, 0x00, 0x41, 0x41, 0x41, 0x42, 0x66, 0x64, 0xff, 0x11, 0x00, 0x00, 0x00,
                //    // mark 0x06 as delete:
                //    //0x0c, 0x49, 0x0c, 0x06, 0x11, 0x75, 0x00, 0x00, 0x09, 0x69, 0xf2, 0x5d, 0x00,
                ////  0x4d, 0x49, 0x0d, 0x02, 0x5e, 0x06, 0x00, 0x00, 0x5d, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x07, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x45, 0x0f, 0x00, 0x73, 0x0a, 0x00, 0x00, 0x00, 0xb2, 0xee, 0xb2, 0xbb, 0xb6, 0xe0, 0xcf, 0xc8, 0xc9, 0xfa, 0x64, 0xff, 0x11, 0x00, 0x00, 0x00
                //});
            }
            else
            {
                Console.WriteLine($"[!] Unknown Protocol. [{loginInfo.Split('\r')[0]}]");
            }
            client.Dispose();
        }

        public void srvJoinCheck(Client client, string[] info)
        {
            var cli = client.tcp;
            var aes = client.aes;
            var stream = cli.GetStream();
            var pos = byte.Parse(info[2].Substring(0, 1));

            // LOGIN 1.3.0.10 11 kalvin00001 26CC6E5F10B90169818A8D7CF883829E 1 // join with hero: 1
            Console.WriteLine($"[+] Join Game. Username[{info[0]}] Pw[{info[1]}] Hero[{pos}]");

            // machine code
            var mac_code = new byte[96];
            stream.Read(mac_code);

            mac_code = aes.decrypt(mac_code);

            if (!Lib.isStartWith(mac_code, new byte[] { 0x6d, 0x61, 0x63, 0x68, 0x69, 0x6e, 0x65, 0x5f, 0x63, 0x6f, 0x64, 0x65, 0x20, 0x61, 0x64, 0x64, 0x20 }))
            {
                Console.WriteLine($"[X] Join Game Failed. Expected Machine Code here. Unknown Recv. [{Lib.toHex(mac_code)}]");
                client.Dispose();
                return;
            }

            Hero hero = Lib.getHero(info[0], pos);
            if (hero == null)
            {
                // 3889 您的资料出了问题，请马上通知ＧＭ。
                client.send(PacketEncoder.alertBox(3889));
                client.Dispose();
                return;
            }

            client.hero = hero;

            if (!Lib.clientList.TryAdd(hero.heroID, client))
            {
                Lib.clientList.GetValueOrDefault(hero.heroID, null)?.Dispose();
                Lib.clientList.Add(hero.heroID, client);
            }

            hero.bag.loadItemsFromDB();

            client.isJoined = true;
            var pkts = new byte[]
            {
                // @ 40459B
                // Login Success
                0x07, 0x49, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00,

                // @ 4F7802
                0x07, 0x3d, 0x2f, 0xce, 0xe4, 0xca, 0xbf, 0x00,

                // @ 4047C8
                0x03, 0x49, 0x02, 0x00,

                // @ 
                0x04, 0x5a, 0x01, 0x00, 0x00,

                // @ 403F98 -- last login record
                0x32, 0x3e, 0x01, 0x25, 0x0f, 0x00, 0x00, 0x73, 0x13, 0x00, 0x00, 0x00, 0x32, 0x30, 0x31, 0x39, 0x2d, 0x31, 0x32, 0x2d, 0x31, 0x32, 0x20, 0x31, 0x30, 0x3a, 0x30, 0x35, 0x3a, 0x32, 0x37, 0x73, 0x0e, 0x00, 0x00, 0x00, 0x31, 0x32, 0x34, 0x2e, 0x32, 0x34, 0x34, 0x2e, 0x31, 0x34, 0x2e, 0x31, 0x31, 0x37, 0x00,
                0x32, 0x3e, 0x01, 0x26, 0x0f, 0x00, 0x00, 0x73, 0x13, 0x00, 0x00, 0x00, 0x32, 0x30, 0x31, 0x39, 0x2d, 0x31, 0x32, 0x2d, 0x31, 0x32, 0x20, 0x32, 0x30, 0x3a, 0x30, 0x36, 0x3a, 0x32, 0x30, 0x73, 0x0e, 0x00, 0x00, 0x00, 0x31, 0x32, 0x34, 0x2e, 0x32, 0x34, 0x34, 0x2e, 0x31, 0x34, 0x2e, 0x31, 0x31, 0x37, 0x00,

                /*
                 * join game notice
                 * text-sz: 0x020d+1 (null terminated)
                 */
                0xff, 0xff, 0x0d, 0x02, 0xa2, 0x0f, 0x01, 0x0d, 0x0a, 0xd3, 0xc9, 0xc0, 0xcf, 0xcd, 0xe6, 0xb6, 0xf9, 0xd3, 0xce, 0xcf, 0xb7, 0xb6, 0xc0, 0xbc, 0xd2, 0xb4, 0xfa, 0xc0, 0xed, 0xa1, 0xa2, 0xb9, 0xe3, 0xd6, 0xdd, 0xcd, 0xf8, 0xd3, 0xce, 0xca, 0xfd, 0xc2, 0xeb, 0xd1, 0xd0, 0xb7, 0xa2, 0xb5, 0xc4, 0x4d, 0x4d, 0x4f, 0x52, 0x50, 0x47, 0xbe, 0xad, 0xb5, 0xe4, 0x51, 0xc3, 0xc8, 0xcd, 0xf8, 0xd3, 0xce, 0xa1, 0xb6, 0xcc, 0xec, 0xd3, 0xf0, 0xb4, 0xab, 0xc6, 0xe6, 0xa1, 0xb7, 0xcf, 0xd6, 0xd2, 0xd1, 0xd5, 0xfd, 0xca, 0xbd, 0xbf, 0xaa, 0xc6, 0xf4, 0xb2, 0xbb, 0xc9, 0xbe, 0xb5, 0xb5, 0xca, 0xd7, 0xb7, 0xfe, 0xa1, 0xb0, 0xc4, 0xb0, 0xc9, 0xcf, 0xd3, 0xf0, 0xbf, 0xaa, 0xa1, 0xb1, 0xa3, 0xa1, 0x0d, 0x0a, 0xb6, 0xe0, 0xd1, 0xf9, 0xb5, 0xc4, 0xd5, 0xbd, 0xb6, 0xb7, 0xcf, 0xb5, 0xcd, 0xb3, 0xa1, 0xa2, 0xbe, 0xab, 0xd6, 0xc2, 0x51, 0xc3, 0xc8, 0xb5, 0xc4, 0xbb, 0xad, 0xc3, 0xe6, 0xa1, 0xa2, 0xc5, 0xe4, 0xd2, 0xd4, 0xd4, 0xad, 0xd6, 0xad, 0xd4, 0xad, 0xce, 0xb6, 0xb5, 0xc4, 0xbe, 0xad, 0xb5, 0xe4, 0xcd, 0xe6, 0xb7, 0xa8, 0xa3, 0xac, 0xd4, 0xe7, 0xd2, 0xd1, 0xc8, 0xc3, 0xb8, 0xf7, 0xce, 0xbb, 0xd0, 0xc2, 0xc0, 0xcf, 0xcd, 0xe6, 0xbc, 0xd2, 0xcd, 0xe6, 0xbc, 0xd2, 0xc7, 0xcc, 0xca, 0xd7, 0xd2, 0xd4, 0xc5, 0xce, 0xa3, 0xa1, 0x0d, 0x0a, 0xc0, 0xcf, 0xcd, 0xe6, 0xb6, 0xf9, 0xd3, 0xce, 0xcf, 0xb7, 0xbd, 0xab, 0xbc, 0xcc, 0xd0, 0xf8, 0xb1, 0xfc, 0xb3, 0xd0, 0xa1, 0xb0, 0xb4, 0xb4, 0xd4, 0xec, 0xbf, 0xec, 0xc0, 0xd6, 0xa3, 0xac, 0xcf, 0xed, 0xca, 0xdc, 0xc9, 0xfa, 0xbb, 0xee, 0xa1, 0xb1, 0xb5, 0xc4, 0xd7, 0xda, 0xd6, 0xbc, 0xa3, 0xac, 0xce, 0xaa, 0xd3, 0xce, 0xcf, 0xb7, 0xcc, 0xe1, 0xb9, 0xa9, 0xce, 0xc8, 0xb6, 0xa8, 0xb5, 0xc4, 0xd4, 0xcb, 0xd3, 0xaa, 0xd6, 0xa7, 0xb3, 0xd6, 0xa3, 0xac, 0xce, 0xaa, 0xd3, 0xc3, 0xbb, 0xa7, 0xcc, 0xe1, 0xb9, 0xa9, 0xd3, 0xc5, 0xd6, 0xca, 0xb5, 0xc4, 0xd3, 0xce, 0xcf, 0xb7, 0xb7, 0xfe, 0xce, 0xf1, 0xa3, 0xac, 0xb9, 0xb9, 0xbd, 0xa8, 0xce, 0xc8, 0xb6, 0xa8, 0xa1, 0xa2, 0xb0, 0xb2, 0xc8, 0xab, 0xa1, 0xa2, 0xb9, 0xab, 0xc6, 0xbd, 0xb5, 0xc4, 0xd3, 0xce, 0xcf, 0xb7, 0xbb, 0xb7, 0xbe, 0xb3, 0xa1, 0xa3, 0x0d, 0x0a, 0xbb, 0xb6, 0xd3, 0xad, 0xb4, 0xf3, 0xbc, 0xd2, 0xd4, 0xda, 0xcc, 0xe5, 0xd1, 0xe9, 0xb9, 0xfd, 0xb3, 0xcc, 0xd6, 0xd0, 0xcc, 0xe1, 0xb3, 0xf6, 0xb8, 0xf7, 0xd6, 0xd6, 0xb1, 0xa6, 0xb9, 0xf3, 0xb5, 0xc4, 0xd2, 0xe2, 0xbc, 0xfb, 0xba, 0xcd, 0xbd, 0xa8, 0xd2, 0xe9, 0xa3, 0xac, 0xd2, 0xb2, 0xcf, 0xa3, 0xcd, 0xfb, 0xb8, 0xf7, 0xce, 0xbb, 0xcd, 0xe6, 0xbc, 0xd2, 0xc4, 0xdc, 0xd2, 0xd4, 0xbf, 0xcd, 0xb9, 0xdb, 0xb0, 0xfc, 0xc8, 0xdd, 0xb5, 0xc4, 0xcc, 0xac, 0xb6, 0xc8, 0xb6, 0xd4, 0xb4, 0xfd, 0xb2, 0xe2, 0xca, 0xd4, 0xb9, 0xfd, 0xb3, 0xcc, 0xd6, 0xd0, 0xb3, 0xf6, 0xcf, 0xd6, 0xb5, 0xc4, 0xce, 0xca, 0xcc, 0xe2, 0xa3, 0xac, 0xd7, 0xa3, 0xc4, 0xfa, 0xd3, 0xce, 0xcf, 0xb7, 0xd3, 0xe4, 0xbf, 0xec, 0xa1, 0xa3, 0x0d, 0x0a, 0xce, 0xd2, 0xc3, 0xc7, 0xd2, 0xd1, 0xbe, 0xad, 0xbf, 0xaa, 0xcd, 0xa8, 0xc1, 0xcb, 0xa1, 0xb6, 0xcc, 0xec, 0xd3, 0xf0, 0xb4, 0xab, 0xc6, 0xe6, 0xa1, 0xb7, 0xbf, 0xcd, 0xb7, 0xfe, 0xcd, 0xa8, 0xb5, 0xc0, 0xa3, 0xac, 0xcb, 0xe6, 0xca, 0xb1, 0xce, 0xaa, 0xb9, 0xe3, 0xb4, 0xf3, 0xcd, 0xe6, 0xbc, 0xd2, 0xcc, 0xe1, 0xb9, 0xa9, 0xb0, 0xef, 0xd6, 0xfa, 0xba, 0xcd, 0xb7, 0xfe, 0xce, 0xf1, 0xa1, 0xa3, 0x00,
                
                // @ 4F7802 - JoinGame-Mark1
                0x07, 0x3d, 0x2f, 0xce, 0xe4, 0xca, 0xbf, 0x00,
                0x04, 0x3d, 0x91, 0x00, 0x00,

                // @ 401D9D - JoinGame-Mark2 - BackPack
                // backpack / armor related (-- 0x2b)
                // high ID = front, low id = back
                // weapon - & desc 3
                //0x16, 0x2b, 0x49, 0xac, 0x04, 0x00, 0x67, 0xb2, 0xd8, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x03, 0x00, 0xa8, 0xd8, 0x01, 0x00, 0x00,
                  //0x16, 0x2b, 0x49, 0xac, 0x04, 0x00, 0x67, 0xb2, 0xd8, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x0A, 0x03, 0x00, 0xa8, 0xd8, 0x01, 0x00, 0x00,

                // M1: the item index (armor only)
                // M2: the item model & base type
                // M3: Armor TypeID, also the desc
                // M4: binding status
                // desc id : aka uid (unique ID)
                //            ---- desc id ---        -pos- ----    M2 (DB)   ----  --stack --              -M4 - -M1 -       ------ M3 ------------
                //0x16, 0x2b, 0x50, 0xac, 0x04, 0x00, 0x05, 0x52, 0x8b, 0x01, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x52, 0x8b, 0x01, 0x00, 0x00,
                //  16    2b    b5    bc    12    00    0a    8d    8a    01    00    14    00    00    01    00    00    00    8d    8a    01    00    00

                // backpack item @ pos 23 - & desc 4ac4c# || 藏寶圖
                //0x16, 0x2b, 0x4c, 0xac, 0x04, 0x00, 0x16, 0x10, 0x52, 0x02, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x00, 0x12, 0x52, 0x02, 0x00, 0x00,
                // backpack item @ pos 17 - & desc 4ac4d# || 生命石。小 (回血用)
                //0x16, 0x2b, 0x4d, 0xac, 0x04, 0x00, 0x12, 0xb7, 0x57, 0x02, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x00, 0x00, 0xb7, 0x57, 0x02, 0x00, 0x00,
                // backpack item @ pos 19 - & desc 4ac4e# || 頂級hp水 (+1400) - stack: 69
                //0x16, 0x2b, 0x4e, 0xac, 0x04, 0x00, 0x14, 0x3a, 0xb0, 0x01, 0x00, 0x45, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x3a, 0xb0, 0x01, 0x00, 0x00,
                // backpack item @ pos 16 - & desc 4ac4e# || 頂級mp水 (+1400) - stack: 79
                //0x16, 0x2b, 0x4f, 0xac, 0x04, 0x00, 0x11, 0x3b, 0xb0, 0x01, 0x00, 0x4f, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x3b, 0xb0, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x50, 0xac, 0x04, 0x00, 0x05, 0x52, 0x8b, 0x01, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x52, 0x8b, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x51, 0xac, 0x04, 0x00, 0x04, 0x8d, 0x8a, 0x01, 0x00, 0x63, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x8d, 0x8a, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x52, 0xac, 0x04, 0x00, 0x03, 0x8e, 0x8a, 0x01, 0x00, 0x63, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x8e, 0x8a, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x53, 0xac, 0x04, 0x00, 0x02, 0x7f, 0x52, 0x02, 0x00, 0x14, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x7f, 0x52, 0x02, 0x00, 0x00,
                //0x16, 0x2b, 0x54, 0xac, 0x04, 0x00, 0x07, 0xa7, 0x57, 0x02, 0x00, 0x01, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0xa7, 0x57, 0x02, 0x00, 0x00,
                //0x16, 0x2b, 0x55, 0xac, 0x04, 0x00, 0x06, 0x6c, 0xb0, 0x01, 0x00, 0x14, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x6c, 0xb0, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x56, 0xac, 0x04, 0x00, 0x0b, 0x6d, 0xb0, 0x01, 0x00, 0x0d, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x6d, 0xb0, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x57, 0xac, 0x04, 0x00, 0x0c, 0x3b, 0xb0, 0x01, 0x00, 0x63, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x3b, 0xb0, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x58, 0xac, 0x04, 0x00, 0x0e, 0x3a, 0xb0, 0x01, 0x00, 0x63, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x3a, 0xb0, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x59, 0xac, 0x04, 0x00, 0x10, 0xa6, 0x57, 0x02, 0x00, 0x03, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0xa6, 0x57, 0x02, 0x00, 0x00,
                //0x16, 0x2b, 0x5a, 0xac, 0x04, 0x00, 0x0a, 0x8e, 0x8a, 0x01, 0x00, 0x28, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x8e, 0x8a, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x5b, 0xac, 0x04, 0x00, 0x0d, 0x8d, 0x8a, 0x01, 0x00, 0x28, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x8d, 0x8a, 0x01, 0x00, 0x00,
                //0x16, 0x2b, 0x5c, 0xac, 0x04, 0x00, 0x01, 0x73, 0x59, 0x02, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x73, 0x59, 0x02, 0x00, 0x00,

                // @ JoinGame-Mark3
                0x07, 0x49, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00,

                /*text-sz: 0x0194+1 (null terminated) -- 5g jm9*/
                //0xff, 0xff, 0x94, 0x01, 0x3d, 0x20, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

                // player pos           0x68
                0x11, 0x3c, 0x11, 0x27, 0x00, 0x00, /*RealMap*/0x68, 0x00, /*X*/0x90, 0x00, /*Y*/0x5A, 0x00, 0x00, /*mapName*/0x5F, 0x00, 0x00, 0x00, 0x00,
                // spawn player pkt
                // PacketEncoder.spawnPlayer(player)
                /*player model*/ 0x5a, 0x69, 0x0b,       0xe3, 0x06, 0x00, 0x00, 0xE3, 0x00, 0x6F, 0x00, 0x01, 0x01, 0x00, 0x01, 0x00, 0x11, 0x27, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0xe7, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3d, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x1a, 0x5c, 0x0c, 0x00, 0x01, 0x02, 0x00, 0xe3, 0x06, 0x00, 0x00, 0xbc, 0xd3, 0xd0, 0xfd, 0x30, 0x35, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00,
                //0x09, 0xb9, 0xa2, 0x01, 0xe3, 0x06, 0x00, 0x00, 0x01, 0x00, // unk
                // sync model
                //                slot  - heroID -------------  model?
                //0x0c, 0x7f, 0x01, 0x67, 0xe3, 0x06, 0x00, 0x00, 0x83, 0x00, 0xa5, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x69, 0xe3, 0x06, 0x00, 0x00, 0x3b, 0x00, 0x3c, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x6e, 0xe3, 0x06, 0x00, 0x00, 0x3b, 0x00, 0x3c, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x6a, 0xe3, 0x06, 0x00, 0x00, 0xa5, 0x00, 0xa5, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x6b, 0xe3, 0x06, 0x00, 0x00, 0x54, 0x00, 0x54, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x6c, 0xe3, 0x06, 0x00, 0x00, 0x54, 0x00, 0x54, 0x00, 0x00,
                //0x0c, 0x7f, 0x01, 0x70, 0xe3, 0x06, 0x00, 0x00, 0x3b, 0x00, 0x3c, 0x00, 0x00,
                
                // broadcast 大p 跑馬燈 (0x69, 0x80)
                //0x20, 0x69, 0x80, 0xe1, 0x67, 0x04, 0x00, 0x78, 0x00, 0xa6, 0x00, 0x00, 0x80, 0x01, 0x9d, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc9, 0xbd, 0xd2, 0xb0, 0xd1, 0xfd, 0xb9, 0xd6, 0x00,
                
                // broadcast 大p 跑馬燈 (0x69, 0x80)
                //0x22, 0x69, 0x80, 0x15, 0x69, 0x00, 0x00, 0x81, 0x00, 0x90, 0x00, 0x06, 0x80, 0x01, 0xc7, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x10, 0xe6, 0x04, 0x00, 0x00,

                // UNK -- ignored
                //0x0d, 0xa5, 0x01, 0x00, 0xfe, 0x77, 0x09, 0x00, 0x64, 0x68, 0x00, 0x00, 0x00, 0x00,
                //0x09, 0x81, 0x24, 0x5c, 0x0c, 0x00, 0x00, 0x00, 0x01, 0x00, //???
                
                // 5g hv wt use
                //0x05, 0x3d, 0x0a, 0x30, 0xFA, 0x00,
                //0x05, 0x3d, 0x0b, 0x30, 0xFB, 0x00,
                //0x05, 0x3d, 0x0c, 0x30, 0xFC, 0x00,
                //0x05, 0x3d, 0x0d, 0x30, 0xFD, 0x00,
                //0x05, 0x3d, 0x0e, 0x30, 0xFE, 0x00,
                
                // window title player id.. lol
                // ori: 0xe3, 0x06
                //                -- player id ---------  -- player name --------------------
                0x0d, 0x3d, 0xa0, 0xe3, 0x06, 0x00, 0x00, 0xbc, 0xd3, 0xd0, 0xfd, 0x30, 0x35, 0x00,

                // unk, but decoded: =武士    武士导师－－      －－
                //0x42, 0x3d, 0xa1, 0x01, 0xce, 0xe4, 0xca, 0xbf, 0x20, 0x20, 0x20, 0x20, 0xce, 0xe4, 0xca, 0xbf, 0xb5, 0xbc, 0xca, 0xa6, 0xa3, 0xad, 0xa3, 0xad, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0xa3, 0xad, 0xa3, 0xad, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x00,

                // player gifts
                0x0d, 0x3d, 0xa2, /*體質*/0x41, 0x00, /*精神*/0x42, 0x00, /*智力*/0x43, 0x00, /*力量*/0x44, 0x00, /*耐力*/0x45, 0x00, 0x00,
                
                // player current status
                0x39, 0x3d, 0xa3, /*hp-int*/0x7a, 0x02, 0x00, 0x00, /*maxHP-int*/0x7d, 0x02, 0x00, 0x00, /*mp-int*/0xcb, 0x00, 0x00, 0x00, /*maxMP-int*/0xcc, 0x00, 0x00, 0x00, /*meleeAtkMin-int*/0x34, 0x00, 0x00, 0x00, /*meleeAtkMax-int*/0x57, 0x00, 0x00, 0x00, /*meleeDefenseMin-int*/0x4c, 0x00, 0x00, 0x00, /*meleeDefenseMax-int*/0x6f, 0x00, 0x00, 0x00, /*magicAtkMin-int*/0x05, 0x00, 0x00, 0x00, /*magicAtkMax-int*/0x05, 0x00, 0x00, 0x00, /*magicDefMin-int*/0x30, 0x00, 0x00, 0x00, /*magicDefMax-int*/0x53, 0x00, 0x00, 0x00, /**/0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xFF, 0x00,

                0x25, 0x3d, 0xa4, 0x00, 0x00, 0xfd, 0x93, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, /*功德*/0xFF, 0xFF, 0xFF, 0x7F, /*屬性配點*/0xFF, 0xF1, /*lv*/0xFF, 0x00, /*exp-int*/0x2a, 0x81, 0x01, 0x00, /*lvExp-int*/0x03, 0x62, 0x02, 0x00, /*money-int*/0xFF, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00,

                0x2b, 0x3d, 0xa5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF1, 0xF2, 0xF3, 0xF4, 0xF5, 0xF6, 0xF7, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*體力-2B*/0x18, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x3d, 0xa6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00,

                0x07, 0x3d, 0x1d, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, // 爆擊 - is int, not float

                0x07, 0x3d, 0x48, 0x44, 0x03, 0x00, 0x00, 0x00, // backpack
                //0x05, 0x3d, 0x7A, 0xFA, 0xFB, 0x00,
                //0x04, 0x3d, 0x80, 0x00, 0x00, // settings? 5g
                //0x04, 0x3d, 0x81, 0x00, 0x00, // settings? 5g
                //0x04, 0x3d, 0x85, 0xFC, 0x00, // ?
                //0x05, 0x3d, 0x8f, 0xFC, 0xFD, 0x00,
                //0x05, 0x3d, 0x90, 0xFE, 0xFF, 0x00,
                0x07, 0x3d, 0xf6, 0x05, 0xFF, 0x00, 0x00, 0x00, // 回避
                0x07, 0x3d, 0xf7, 0x0c, 0xFF, 0x00, 0x00, 0x00, // 命中

                0x07, 0xa5, 0x08, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, // 戰績
                0x04, 0xa2, 0x0a, 0xFF, 0x00, // 修為等級

                //0x06, 0x74, 0x5a, 0x31, 0x69, 0x12, 0x00,
                //0x07, 0xa2, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00,
                0x07, 0x45, 0x07, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, // 元寶

                //0x07, 0xad, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00,

                //// skill tree start
                //0x06, 0x53, 0x00, 0x00, 0x00, 0x00, 0x00,
                //// page 1 (role skills)
                //// skills tree lv (-- 0x53)
                //0x13, 0x53, 0x30, 0xc8, 0x07, 0x00, /*lv*/0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xc8, 0x07, 0x00, 0x00,
                //// skills (-- 0x50)
                //0x21, 0x50, 0x3a, 0xc8, 0x07, 0x00, 0x03, 0x00, 0x00, 0x00, /**/0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x91, 0xb0, 0x0a, 0x00, 0x64, 0x3a, 0xc8, 0x07, 0x00, 0x64, /*skill-lv*/0x04, 0x00, 0x00, 0x00, 0x00,
                //// equipped skill (-- 0x64)
                ////          -- skill id ----                          --
                //0x0e, 0x64, 0x3a, 0xc8, 0x07, 0x00, 0x06, 0x00, 0x00, 0x04, 0x07, 0x0a, 0x05, 0x00, 0x00,

                //0x1c, 0x50, 0x44, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x44, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x4e, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x4e, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x58, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x58, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x62, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x62, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x6c, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x6c, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x76, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x76, 0xc8, 0x07, 0x00, 0x00,
                
                //// next role skill set
                //0x13, 0x53, 0x94, 0xc8, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x9e, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x9e, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0xa8, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xa8, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0xb2, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xb2, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0xbc, 0xc8, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xbc, 0xc8, 0x07, 0x00, 0x00,
                
                //// next role skill set
                //0x13, 0x53, 0xf8, 0xc8, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xc8, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x02, 0xc9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x02, 0xc9, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x0c, 0xc9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x0c, 0xc9, 0x07, 0x00, 0x00,
                //0x1c, 0x50, 0x16, 0xc9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x16, 0xc9, 0x07, 0x00, 0x00,
                
                //// next role skill set              -lv-
                //0x13, 0x53, 0x5c, 0xc9, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5c, 0xc9, 0x07, 0x00, 0x00,
                //// next role skill set
                //0x13, 0x53, 0xc0, 0xc9, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc9, 0x07, 0x00, 0x00,
                //// next role skill set
                //0x13, 0x53, 0x24, 0xca, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0xca, 0x07, 0x00, 0x00,
                //// next role skill set
                //0x13, 0x53, 0x88, 0xca, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0xca, 0x07, 0x00, 0x00,
                
                //// page 2 (special skills)          -lv-
                //0x11, 0x55, 0x18, 0x94, 0x08, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x94, 0x08, 0x00, 0x00,
                //// 0x19, 0x94, 0x08 -- 面具触发效果
                //0x1c, 0x50, 0x19, 0x94, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x19, 0x94, 0x08, 0x00, 0x00,
                //0x0e, 0x64, 0x19, 0x94, 0x08, 0x00, 0x00, 0x00, 0x01, 0x0d, 0x00, 0x00, 0x05, 0x00, 0x00,
                //// 0x1A, 0x94, 0x08 -- 尾巴触发效果
                //0x1c, 0x50, 0x1a, 0x94, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x1a, 0x94, 0x08, 0x00, 0x00,
                //0x0e, 0x64, 0x1a, 0x94, 0x08, 0x00, 0x00, 0x00, 0x01, 0x0d, 0x00, 0x00, 0x05, 0x00, 0x00,

                //// last page (basic skills)
                //0x1c, 0x50, 0x9a, 0xb2, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x9a, 0xb2, 0x08, 0x00, 0x00,
                //0x1c, 0x50, 0xa4, 0xb2, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xa4, 0xb2, 0x08, 0x00, 0x00,
                //0x1c, 0x50, 0xe0, 0xb2, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xe0, 0xb2, 0x08, 0x00, 0x00,

                //0x1c, 0x50, 0x1c, 0xb3, 0x08, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x1c, 0xb3, 0x08, 0x00, 0x00,
                //0x0e, 0x64, 0x1c, 0xb3, 0x08, 0x00, 0x00, 0x00, 0x00, 0x08, 0x5e, 0x00, 0x05, 0x00, 0x00,

                //0x1c, 0x50, 0xea, 0xb2, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0xea, 0xb2, 0x08, 0x00, 0x00,
                //0x1c, 0x50, 0x30, 0xb3, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x30, 0xb3, 0x08, 0x00, 0x00,
                //0x1c, 0x50, 0x3a, 0xb3, 0x08, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x3a, 0xb3, 0x08, 0x00, 0x00,
                //0x1c, 0x50, 0x44, 0xb3, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, 0x44, 0xb3, 0x08, 0x00, 0x00,
                //// 雲遊商人 : 26 b3 08
                //0x1c, 0x50, 0x26, 0xb3, 0x08, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6a, 0xcb, 0x10, 0x00, 0x64, /*sid*/0x26, 0xb3, 0x08, 0x00, 0x00,

                //                  570010
                // item bar   pos-  SkillID (GBK)---------------------
                //0x09, 0x4b, 0x01, 0x35, 0x37, 0x30, 0x31, 0x34, 0x30, 0x00,
                //0x09, 0x4b, 0x02, 0x35, 0x31, 0x30, 0x30, 0x31, 0x30, 0x00,
                //0x09, 0x4b, 0x06, 0x35, 0x37, 0x30, 0x30, 0x31, 0x30, 0x00,
                //0x09, 0x4b, 0x09, 0x35, 0x37, 0x30, 0x30, 0x31, 0x30, 0x00,
                //0x09, 0x4b, 0x0a, 0x35, 0x37, 0x30, 0x30, 0x38, 0x30, 0x00,

                //0x15, 0xa9, 0x16, 0x37, 0x77, 0x4a, 0x46, 0x24, 0x24, 0x4a, 0x31, 0x33, 0x39, 0x37, 0x7e, 0x2a, 0x4a, 0x38, 0x32, 0x75, 0x37, 0x00,

                0x13, 0xa2, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc4, 0xd2, 0x0d, 0xa2, 0x00,
                0x0d, 0xa2, 0x04, 0xa2, 0x01, 0xf0, 0x51, 0x54, 0x00, 0xf0, 0x51, 0x54, 0x00, 0x00,

                // player title [from formatstring.dat]
                //0x35, 0xae, 0x03, 0x02, 0xe6, 0x27, 0x00, 0x00, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x2e, 0x64, 0x61, 0x74, 0x0a, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x0a, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x0a, 0xa5, 0xc3, 0xc5, 0x51, 0xa4, 0xd1, 0xa4, 0x55, 0x0a, 0x00,
                //0x35, 0xae, 0x03, 0x02, 0xe5, 0x27, 0x00, 0x00, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x2e, 0x64, 0x61, 0x74, 0x0a, 0x66, 0x6f, 0x72, 0x6d, 0x61, 0x74, 0x73, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x0a, 0x74, 0x69, 0x74, 0x6c, 0x65, 0x0a, 0xad, 0xb7, 0xb9, 0x4c, 0xb5, 0x4c, 0xb2, 0xaa, 0x0a, 0x00,

                // unk - JoinGame-MarkZ
                //0x09, 0x81, 0x24, 0x5c, 0x0c, 0x00, 0x00, 0x00, 0x01, 0x00,

                // spawn NPC
                //0x22, 0x69, 0x80, 0x96, 0x69, 0x00, 0x00, 0xa2, 0x00, 0x78, 0x00, 0x02, 0x80, 0x01, 0xee, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x26, 0x34, 0x05, 0x00, 0x00,
                //0x22, 0x69, 0x80, 0x43, 0x69, 0x00, 0x00, 0xa8, 0x00, 0x65, 0x00, 0x04, 0x80, 0x01, 0xee, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x30, 0x34, 0x05, 0x00, 0x00,
                //0x22, 0x69, 0x80, 0x98, 0x69, 0x00, 0x00, 0x92, 0x00, 0x61, 0x00, 0x01, 0x80, 0x01, 0x7d, 0x15, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x4e, 0x34, 0x05, 0x00, 0x00,
                //0x22, 0x69, 0x80, 0x99, 0x69, 0x00, 0x00, 0xa6, 0x00, 0x5f, 0x00, 0x06, 0x80, 0x01, 0x7d, 0x15, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x62, 0x34, 0x05, 0x00, 0x00,
                //0x22, 0x69, 0x80, 0x42, 0x69, 0x00, 0x00, 0x99, 0x00, 0x60, 0x00, 0x04, 0x80, 0x01, 0xe7, 0x26, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x66, 0x42, 0x0f, 0x00, 0x64, 0x1c, 0x34, 0x05, 0x00, 0x00,
                
                // spawn mob        --ID------------------- 
                //0x27, 0x69, 0x80, 0xb0, 0x67, 0x02, 0x00, 0xa7, 0x00, 0xca, 0x00, 0x06, 0x82, 0x01, 0xf5, 0x41, 0x06, 0x00, 0x32, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x91, 0xb0, 0x0a, 0x00, 0x64, 0xf5, 0x41, 0x06, 0x00, 0x64, 0x0d, 0x00, 0x00, 0x00, 0x00,

                // 跑馬 + chat - 白字 - 嫦娥
                //0x20, 0xa3, 0x01, 0x4c, 0x32, 0x00, 0x00, 0x64, /*map1*/0x65, 0x00, 0x00, 0x00, 0x64, /*map2*/0x6a, 0x00, 0x00, 0x00, 0x64, /*map3*/0x6b, 0x00, 0x00, 0x00, 0x64, /*map4*/0x66, 0x00, 0x00, 0x00, 0x64, /*map5*/0xcd, 0x00, 0x00, 0x00, 0x00,
            };

            // player ready
            //PacketEncoder.concatPacket(Lib.hexToBytes("3d01 e3060000 0200"), ref pkts);
            //client.send(pkts);

            (hero as ILivingEntity).addBuff(840000, 1);
            (hero as ILivingEntity).addBuff(0x0893bf, 1);

            hero.effects ??= new List<Effect>();
            hero.effects.Add(new Effect(0x70, 0x02, 0x01, 0x02));
            hero.effects.Add(new Effect(0x6f, 0x04, 0x02, 0x02));
            hero.effects.Add(new Effect(0x6e, 0x02, 0x01, 0x02));

            client.send(PacketEncoder.playerJoin(hero));

            // update player ready
            ((ILivingEntity)hero).state = 0x02;

            // sync to all nearby players
            Lib.sendToNearby(hero, PacketEncoder.spawnHero(hero, true));

            // spawn nearbys
            Lib.spawnNearbys(client, hero, 16, false);

            client.startListen();

            //Console.WriteLine("send? :D");

            //Lib.broadcast(PacketEncoder.spawnNPC(311396, new Location(234, 113, Map.TYC)));
            //Lib.broadcast(PacketEncoder.spawnNPC(311398, new Location(232, 111, Map.TYC)));

            // 10 83 e3060000 40d10c00 53d10c00 0F 0F 00 // buff | 0F: buff time in sec
            
            /**
            
            // player title TypeA [found in DB]
                     heroID--    ???? ???? ????         --colorCode (string)-------- __ titleID-
            24 a2 14 89240e00 00 9fcb 1000 730e 0000 00 602b433078323766353263602d43 64 13270000 00
            24 a2 14 e3060000 00 9fcb 1000 730e 0000 00 602b433078313462666634602d43 64 e4270000 00
            // player title TypeB (direct text)
            //       heroID-- GBK-string---------- __
            11 a2 14 dc290e00 1b43b7e7bba8d1a9d4c2 00 // 风花雪月

            
            09 b9 a2 01 dc290e00 02 00
            16 62 dc 290e001b000000000000000a00000000300000 00
            09 b9 a9 01 dc290e00 01 00
            196fdc290e00b7a60c00080276d10c00020177d10c0004020200
            0c 83 dc290e00 40d10c00 01 01 00 // have cf share attack
            0f a2 0d ba190000 cee4c1a6cac0bcd2 00 // 武力世家 -- BL name
            0c 95 68 02 dc290e00 00000000 00

            // blue name -- update player state
            083d01 e3060000 0200

            //       entityID sign content------
            10 a8 01 89240e00 05b3cfcadbb1bebac5 00 // sign // entityID: 89240e00
            //       heroID-- playerName------
            0f a2 0d 166a0000 cee4c1a6cac0bcd2   00 //         realID: 166a0000 | 武力世家 -- BL name

            //    heroID-- buffID--
            0c 83 89240e00 40d10c00 01 01 00 // have cf share attack


            54690a89240e00e3006f00030201010011270000000009000c631800fbde1800fbdee9039b422800e7d10000000011000000070000003d0f00001ff805053200166a0000b3f5cec7b8f8c1cbd1cc20202020202000
            24 a2 14 89240e00 00 9fcb1000 730e000000 60 2b433078323766353263602d43 64 1327000000 // title & color of title name, color: "2b433078313462666634602d43"
            09b9 a2 01 89240e00 01 00 // additional info[type: a2] for entity 89240e00   | 01: sz of infos | ending 01 still unk...
            1662 89240e00 1b 000000 00000000 0a00 0000 0030 0000 00 // ride, rideID: 1b00
            09b9 a9 01 89240e00 01 00 // additional info[type: a9] for entity 89240e00
            0c95680289240e000000000000

            // use ride item time wait:
            //         itemUID- time----
            __ a6 0a01 04d51800 23830c00 00 // item uid: 0x18d504
            __ 5a 02 0500 b31d0000 00      // time wait message format string id: 0x1db3 (@ formatstring.dat) | spawning ride ... (骑宠召唤中...) | Progress Bar Theme (进度条主题)

            // use ride item wait complete:
            __ 31 04d5180000 00
            __ 78 17690000 00
            // respawn player model
            __ 69 0a f9d41800 f9 00 66 00 04 02 01 0100 1127 00000000 0100 e780 00000000 00000000 0000 0000 1c00 0000 0000 0000 0000000000000000 3e01 00000000 0000 3200b20d 0000 34353634353634352020202020202020 00
            __ b9 a201 f9d41800 04 00 // act 4 ( sit )
            //    heroID-- ride ???? dye- ???? wLv- ???? wID- ???? __
            __ 62 f9d41800 1200 0000 0000 0000 0000 0000 0000 0000 00 // ride ID: 0x0012 idx:b9a201
            __ 62 547e1600 1f00 0000 0000 0000 0a00 0000 4108 0000 00 // 0a00: wing lv (羽) 0b00: 翼 | 4108: wings model ID // 黑羽
            __ 62 9dd91300 1b00 0000 0000 0000 0000 0000 0000 0000 00 // None | 凤尾狐
            __ 62 60dd1300 1b00 0000 b962 0000 0b00 0000 2761 0000 00 // Golden Ride Wings (金翼) | 紫電 | dye color: b962 (of ride)
            __ 62 61ae1600 1b00 0000 b962 0000 0a00 0000 2761 0000 00 // Golden Ride Small Wings (金羽) | 紫電
            __ 62 78641100 1b00 0000 b962 0000 0a00 0000 0030 0000 00 // Red Ride Small Wings (紅羽) | 紫電
            __ 62 06c60d00 2100 0000 e81a 0000 0a00 0000 4108 0000 00 // Black Ride Small Wings (黑羽)
            // ???????
            __ 7f 0167 b20d0000 2200 2300 00
            __ 7f 0169 b20d0000 6400 6400 00
            __ 69 8017690000e8006b00018001e72600000000000000000066420f006442e60400 00
            __ a8 05176900000280250000 00

            // ????? heroID-- [sectionA]
            __ 3d f8 f9d41800 03 00
            // ??????
            __ 81 245c0c00000001 00
            __ 3d f604000000 00
            //    heroID--
            __ 6f f9d41800 305c0c00 01 02 01 00 // spawn ride effect 
            __ 6f b67c1600 70d10c00 02 01 02 00 // ?
            // ...   heroID-- [end of sectionA]
            __ 3d f8 f9d41800 03 00
            __ 5a 0101 00


            //
            08a2 06 bd310000 55 00 # 55: 修為 85


            // pet
            5f690ac47e1600ec00af0003810f000000000000000004009ad608004a6208004a620d000000000000000000000004000000000000003d0b088a00f8000032020000000000b6ae0a0073020000004e42730a000000d8af41726573d8bcc1e800
            08b9a3c47e16000100
            0b40c47e1600dad69d120f00

            // one of these is Black Ride Small Wings (黑羽)
            54690a547e1600ed00b000060201010011270000000008000c632400000024000000e9039b421500e7d10000000000000000070000003e0c00001ff803031a0029050000d8af41726573d8bcc1e820202020202000
            24a214547e1600009fcb1000730e000000602b433078323766353263602d43641327000000
            09b9 a201 547e1600 02 00
            1662547e16001f00000000000000 0a00 0000 4108 0000 00 // 0a00: ride wings on, 4108: wings model ID
            09b9 a901 547e1600 01 00
            0c83 547e1600 40d10c00 01 01 00 // cf buff
            0da20d29050000ccecd2febed300
            0c956802547e16000000000000

            // Black Ride Small Wings (黑羽), leader, on fire, heart effect
            54690ab67c1600ef00b30006020101001127000000000900e7392600000026000000e9039b4207009e430000000006000000140000003d0a0000bffc040432000c270000a8c4a8c4a8c22020202020202020202000
            11a214b67c16001b43befdc1d9cceccfc200
            09b9 a201 b67c1600 01 00
            1662b67c16001d00000000000000 0a00 0000 4108 0000 00
            09b9 a901 b67c1600 01 00
            1ba2 25 b67c1600007f760000642e780900648a760000648376000000 // TY title idx:a225
            0d6f b67c1600 70 d1 0c 00 02 01 02 00
            0d6f b67c1600 6f d1 0c 00 04 02 02 00
            0d6f b67c1600 6e d1 0c 00 04 02 02 00
            0d6f b67c1600 6e d1 0c 00 04 02 02 00
            0d6f b67c1600 6e d1 0c 00 04 02 02 00
            0d6f b67c1600 6e d1 0c 00 04 02 02 00
            0d6f b67c1600 6e d1 0c 00 04 02 02 00
            196f b67c1600 10 5c 0c 00 01 02 b7 a6 0c 00 08 02 30 5c 0c 00 04 02 02 00 // team leader
            1083 b67c1600 40d10c00 53d10c00 01 01 00 // teacher's attack share buff & the richest vip buff
            0c83b67c1600105c0c00010000
            11a20d0c270000a4a6b7e8c8cbd4bad8bc00
            0c956802b67c16000000000000

            // Golden Ride Small Wings (金羽)
            54690a61ae1600e1009700030201eb03f92a000000000a000c63ff03fbdeff03fbde1d046a46ef0315520000000001000000070000003e060000bffc01012a00fa2800004bd8bc6ba9622020202020202020202000
            24a21461ae1600009fcb1000730e000000602b433078313462666634602d43649527000000
            09 b9 a201 61ae1600 04 00
            166261ae16001b000000b9620000 0a00 0000 2761 0000 00
            09 b9 a901 61ae1600 01 00
            0d 6f 61ae1600 b7a60c0008020200 // player effect
            0c 83 61ae1600 40d10c00 01 01 00
            0f a2 0dfa280000b6e0c0bcd6aec8d000
            0c95680261ae16000000000000


            // bottom effect (sit f8) (with a book icon), buff: teacher's attack share)
            54690a7e491600e6007d0003020401001127000000000800e7802600000026000000e9039b422800c9a10000000000000000070000003e0c00001ff80505320084670000a4b8e3e5d2b6c7e5b7e7a4c32020202000
            24a2147e491600009fcb1000730e000000602b433078323766353263602d43641327000000
            09 b9 a201 7e491600 04 00
            09 b9 a901 7e491600 01 00
            1ba2257e491600007f76000064327809006492760000648776000000
            0d6f7e491600 70d10c0002010200
            0d6f7e491600 6fd10c0004020200
            0d6f7e491600 43d10c0004020200
            0c837e491600 40d10c00 01 01 00 // teacher's attack share buff
            0fa20d84670000b6e0c0bcd6aec8d000
            0c9568027e4916000000000000
            2269801b690000f6007f000680019b2300000000000000000066420f006492e6040000
            09721b69000000af0100

            // bottom effect (f8 | no icon, buff: teacher's attack share)
            54690a33b61800b1005600060204e903f92a000000000b00895aea030000ea0300001d046a46ef0315520000000011000000070000003e0c0000bffc040429009a3a0000a6f3a6f3c2b7a4c5c2b720202020202000
            24a21433b61800009fcb1000730e000000602b433078323766353263602d43641327000000
            09 b9 a201 33b61800 04 00
            09 b9 a901 33b61800 01 00
            1ba22533b61800007f76000064287809006493760000648076000000
            0d6f33b61800 70d10c0002010200
            0d6f33b61800 6fd10c0004020200
            0d6f33b61800 6ed10c0004020200
            0d6f33b61800 6ed10c0004020200
            0c8333b61800 40d10c00 01 01 00 // teacher's attack share buff
            0fa20d9a3a0000546861744769726c00
            0c95680233b618000000000000
            22698095690000ae005800028001c72400000000000000000066420f00641234050000
             */
//            client.send(Lib.hexToBytes(@"
//54690a89240e00e3006f00030201010011270000000009000c631800fbde1800fbdee9039b422800e7d10000000011000000070000003d0f00001ff805053200166a0000b3f5cec7b8f8c1cbd1cc20202020202000
//24a214 89240e00 009fcb100073 0e000000 60 2b433078323766353263602d43 641327000000

//09b9 a2 01 89240e00 01 00
//1662 89240e00 0d 0000 0000 00 0000 0a00 0000 0030 0000 00

//09b9 a9 01 89240e00 01 00
//0c95680289240e000000000000


//54690a d7c10d00 e5006d00050201040011270000000008000c6326000000260000000c000000280015520000000004000000070000003e0f00001ff805051900e43f0000a4b8bbd2ccabc0c7d8bc20202020202000
//24a2 14 d7c10d00 009fcb100073 0e000000 60 2b433078313462666634602d43 64e427000000

//09 b9 a2 01 d7c10d00 04 00
//1662 d7c10d00 1f000000226200000b0000002761000000

//09b9a901 d7c10d00 0100
//1ba225 d7c10d00 007f760000642a7809006494760000648276000000

//0d6f d7c10d00 70 d10c 00 02 01 02 00
//0d6f d7c10d00 6f d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6e d10c 00 04 02 02 00
//0d6f d7c10d00 6d d10c 00 02 01 02 00
//0d6f d7c10d00 6c d10c 00 02 01 02 00
//0d6f d7c10d00 5d d10c 00 04 02 02 00
//0d6f d7c10d00 76 d10c 00 02 01 02 00
//0d6f d7c10d00 74 d10c 00 02 01 02 00
//0d6f d7c10d00 70 d10c 00 02 01 02 00
//0d6f d7c10d00 30 5c0c 00 04 02 02 00

//1083 d7c10d00 40 d10c 00 53 d1 0c 00 01 01 00
//11a20de43f0000a4a6b7e8c8cbd4bad8bc00
//0c956802 d7c10d00 0000000000
//"));

            // fade in map name (part of TP transition)
            // map: 68 = 104
            // 0da50100fe77090064 68 00000000
//            client.send(Lib.hexToBytes(@"
//54690a8ea20600e7006f00020201e903f92a000000000a000c630404089a0404c84b1d046a461004c9a10000000006000000070000003d0c00001ff805052900d5670000ccecbbf9cdf5fa51cef520202020202000
//11a2148ea206001b43cceccab9c5aecdf500

//09 b9 a2 01 8ea20600 01 00
//16628ea206001b000000b96200000b0000000030000000

//09b9a9018ea206000100
//0d6f8ea2060079d10c0002010200

//0c838ea2060040d10c00010100
//0fa20dd5670000cee4c1a6cac0bcd200
//0c9568028ea206000000000000

//22698098690000920061000180017d1500000000000000000066420f00644e34050000
//0ca80598690000028725000000
//2269804269000099006000048001e72600000000000000000066420f00641c34050000
//097242690000004f0000
//22698099690000a6005f000680017d1500000000000000000066420f00646234050000
//0ca80599690000028725000000"));

            //var tmp_p = new Player(Lib.loadBasicInfos[5]);
            //tmp_p.loc = new Location(0x93, 0x5f, Map.TYC);
            //tmp_p.facing = 0x1;
            //client.send(PacketEncoder.spawnPlayer(tmp_p, true));
        }
    }
}
